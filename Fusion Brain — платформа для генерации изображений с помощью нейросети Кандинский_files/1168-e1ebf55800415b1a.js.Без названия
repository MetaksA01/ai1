"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1168],{91785:function(e,t,n){n.d(t,{gc:function(){return c},X3:function(){return s},Rf:function(){return a},L1:function(){return d},C5:function(){return u},sR:function(){return l}});let r="https://cdn.fusionbrain.ai",i="https://api.fusionbrain.ai",o="https://auth.fusionbrain.ai/realms/FB",a={getStyles:"".concat(r,"/static/styles/web"),sendImageToGenerate:"".concat(i,"/web/api/v1/text2image/run"),checkImage:e=>"".concat(i,"/web/api/v1/text2image/status/").concat(e),availabilityCheck:"".concat(i,"/web/api/v1/text2image/availability"),cancelGeneration:e=>"".concat(i,"/web/api/v1/text2image/cancel/").concat(e)},c={getPrompts:"".concat(r,"/static/animation/prompts/web"),getDirections:"".concat(r,"/static/animation/directions/web"),sendToGenerate:"".concat(i,"/web/api/v1/animation/run"),checkAnimation:e=>"".concat(i,"/web/api/v1/animation/status/").concat(e),availabilityCheck:"".concat(i,"/web/api/v1/animation/availability"),cancelGeneration:e=>"".concat(i,"/web/api/v1/animation/cancel/").concat(e)},l={sendToGenerate:"".concat(i,"/web/api/v1/text2video/run"),checkVideo:e=>"".concat(i,"/web/api/v1/text2video/status/").concat(e),availabilityCheck:"".concat(i,"/web/api/v1/text2video/availability"),cancelGeneration:e=>"".concat(i,"/web/api/v1/text2video/cancel/").concat(e)},u={userInfo:"".concat(o,"/lk/user-info"),changePassword:"".concat(o,"/lk/update-password"),subscription:"".concat(o,"/lk/subscription"),user:"".concat(i,"/user-manager/api/v1/user")},s={apiKeys:"".concat(i,"/api-key-manager/api/v1/api-keys"),apiKeyById:e=>"".concat(i,"/api-key-manager/api/v1/api-keys/").concat(e)},d={uploadPreview:"".concat(i,"/history/api/v1/text2image/file/upload"),history:"".concat(i,"/history/api/v1/text2image/")}},95657:function(e,t,n){var r,i,o,a;n.d(t,{B:function(){return r}}),(o=r||(r={})).INITIAL="INITIAL",o.PROCESSING="PROCESSING",o.DONE="DONE",o.FAIL="FAIL",(a=i||(i={})).ACTIVE="ACTIVE",a.DISABLED_BY_QUEUE="DISABLED_BY_QUEUE",a.DISABLED_MANUALLY="DISABLED_MANUALLY"},27091:function(e,t,n){var r,i,o,a,c,l;n.d(t,{Ns:function(){return o},XR:function(){return i},zZ:function(){return r}}),(a=r||(r={})).TEXT_2_IMAGE="text2image",a.ANIMATION="animation",a.VIDEO="video",(c=i||(i={})).inpainting="INPAINTING",c.generate="GENERATE",(l=o||(o={})).RIGHT="RIGHT",l.LEFT="LEFT",l.UP="UP",l.DOWN="DOWN",l.SPIN_CLOCKWISE="SPIN_CLOCKWISE",l.SPIN_COUNTERCLOCKWISE="SPIN_COUNTERCLOCKWISE",l.ZOOM_IN="ZOOM_IN",l.ZOOM_OUT="ZOOM_OUT",l.ROTATE_RIGHT="ROTATE_RIGHT",l.ROTATE_LEFT="ROTATE_LEFT",l.ROTATE_UP="ROTATE_UP",l.ROTATE_DOWN="ROTATE_DOWN",l.AROUND_RIGHT="AROUND_RIGHT",l.AROUND_LEFT="AROUND_LEFT",l.ZOOM_IN_SINUS_X="ZOOM_IN_SINUS_X",l.ZOOM_OUT_SINUS_Y="ZOOM_OUT_SINUS_Y",l.RIGHT_SINUS_Y="RIGHT_SINUS_Y",l.LEFT_SINUS_Y="LEFT_SINUS_Y",l.LIVE="LIVE"},10953:function(e,t,n){n.d(t,{CM:function(){return c},PA:function(){return a},V1:function(){return l},eb:function(){return d},pg:function(){return s},wk:function(){return u}});var r=n(98116),i=n(60855),o=n(94296);let a=(0,r.yM)("setModel");(0,r.UP)({clock:a,target:i.LC});let c=(0,r.yM)("updateText2ImageParams"),l=(0,r.yM)();(0,r.UP)({clock:c,target:i.R4,source:i.R4,fn:(e,t)=>Object.assign({},e,t)});let u=(0,r.yM)("updateAnimationModelParams");(0,r.UP)({clock:u,target:i.GA,source:i.GA,fn:(e,t)=>Object.assign({},e,t)});let s=(0,r.yM)("updateVideoModelParams");(0,r.UP)({clock:s,source:i.Uy,target:i.Uy,fn:(e,t)=>Object.assign({},e,t)});let d=(0,r.GW)(o.A.getStyles);(0,r.UP)({clock:d.doneData,target:i.lO,fn:e=>{let{data:t}=e;return t}}),(0,r.UP)({clock:l,target:i.R4.reinit})},71168:function(e,t,n){n.d(t,{$:function(){return ey},FS:function(){return ej},P:function(){return eu},pV:function(){return eP},cl:function(){return e_},tG:function(){return eA},X7:function(){return eS},FB:function(){return eU},z2:function(){return ew},Y_:function(){return eO},kz:function(){return eE},T2:function(){return eh},$A:function(){return ec},CS:function(){return eg},gS:function(){return eI},Qj:function(){return eT},QZ:function(){return em},bz:function(){return eb},p0:function(){return ev},_7:function(){return ek},X9:function(){return eM}});var r=n(98116),i=n(22523),o=n(45877),a=n(27091),c=n(40078);let l=(e,t,n)=>{let r={width:t,height:n};return 1===e[0]&&1===e[1]?(r.width=1024,r.height=1024):9===e[0]&&16===e[1]?(r.width=576,r.height=1024):16===e[0]&&9===e[1]?(r.width=1024,r.height=576):3===e[0]&&2===e[1]?(r.width=960,r.height=640):2===e[0]&&3===e[1]&&(r.width=640,r.height=960),r};var u=n(94296),s=n(2568),d=n.n(s);let g=(e,t)=>[...t.sort((t,n)=>(0,o.f8)(t,e)-(0,o.f8)(n,e))],p=(e,t)=>[...t.sort((t,n)=>e.findIndex(e=>e.id===t)-e.findIndex(e=>e.id===n))];var f=n(29613),m=n(22335),h=n(55733),v=n.n(h),I=n(84898);let y=new u.A,P=e=>{let{generateParams:t,generateSize:n,position:r}=e,o=(0,c.k)(),a={width:t.width,height:t.height,x:r.x,y:r.y};return{name:"Layer ".concat(i.V9.getState()),id:o,isLoading:!0,shape:a,generateParams:{...t,...n}}},b=e=>{let t,[n,r,i,c,u,s,d]=e,g=d,p=(0,o.sI)(n);if((0,o.LY)(r,c),p)(t=Object.assign({},p,{isLoading:!0})).generateParams.type===a.XR.inpainting?t.generateParams.inPaintingParams.query=r.generateParams.query:t.generateParams.generateParams.query=r.generateParams.query,t.generateParams.style=r.style,t.generateParams.negativePromptDecoder=r.negativePromptDecoder,t.generateParams.censor.useGigaBeautificator=r.censor.useGigaBeautificator;else{let e=Object.values(i).some(e=>(0,o.FY)(e.shape,{...u,...s})),n={...r,type:e?a.XR.inpainting:a.XR.generate};e&&(g=(0,o.r4)(),n.inPaintingParams=n.generateParams,delete n.generateParams),t=P({generateParams:n,generateSize:l(c,r.width,r.height),position:s})}return{objects:Object.assign({},i,{[t.id]:t}),previousGeneratedObjectId:t.id,previousGeneratedObjectFile:g,continueGeneration:t}},M=async e=>{let{object:t,file:n}=e;if(t){let e=await y.sendImageToGenerate(t.generateParams,n),r=await (0,o.n$)(e.data.images[0]);return{response:e,url:r}}return null},T=(e,t)=>{var n,r,i,c,l,u;let[s,d,g,p]=e,{response:f,url:m}=t,{status:h,censored:v}=f.data,I=(0,o.sI)(g),y={...p,[I.id]:null};if("DONE"!==h||v&&I.generateParams.type!==a.XR.generate){if(v&&I.generateParams.type===a.XR.inpainting)return{...(0,o.WS)(s,d,g,!0),imageFiles:y,censoredPrompt:{prompt:null==I?void 0:null===(l=I.generateParams)||void 0===l?void 0:null===(u=l.inPaintingParams)||void 0===u?void 0:u.query,context:"/editor"},setSidebarBadgeStatus:{page:"generate",status:"error"}}}else{let e=(0,o.eF)(d,g,{imageUrl:m,imageId:null,isLoading:!1});return I.groupId?{list:s,objects:e,imageFiles:y,censoredPrompt:v?{prompt:null==I?void 0:null===(i=I.generateParams)||void 0===i?void 0:null===(c=i.generateParams)||void 0===c?void 0:c.query,context:"/editor"}:null,setSidebarBadgeStatus:{page:"generate",status:v?"error":"success"}}:{...(0,o.qH)(s,e,I),imageFiles:y,censoredPrompt:v?{prompt:null==I?void 0:null===(n=I.generateParams)||void 0===n?void 0:null===(r=n.generateParams)||void 0===r?void 0:r.query,context:"/editor"}:null,incrementObjectsCount:!0,setSidebarBadgeStatus:{page:"generate",status:v?"error":"success"}}}return{list:s,objects:d,imageFiles:y,setSidebarBadgeStatus:{page:"generate",status:"success"}}},k=e=>{let[t,n,r]=e;return{...(0,o.WS)(t,n,r,!0),addNotification:{type:f.Pu.ERROR,messageKey:"errorPerGenerationMsg",context:"/editor"},setSidebarBadgeStatus:{page:"generate",status:"fail"}}},w=e=>{let[t,n,r]=e;return y.cancelGeneration(y.previousGeneratedPocketId),clearTimeout(y.generateTimer),(0,o.WS)(n,r,t,!0)},U=e=>({preview:{type:"image",id:e.key,visible:!0,shapeProps:e.shapeProps,isLoading:!0,base64:e.base64},continuePreviewInsert:e}),S=async e=>({url:e.base64,imageId:d()(e.base64)}),A=(e,t)=>{let{url:n,imageId:r}=t;return{...e,imageUrl:n,imageId:r,isLoading:!1}},j=()=>({imagePreview:null,addNotification:{messageKey:"processingError",closable:!1,timeout:0,type:f.Pu.ERROR}}),R=(e,t)=>{let{id:n,params:r}=t;return(0,o.eF)(e,n,r)},O=(e,t)=>{let{id:n,params:r}=t;return[...e].map(e=>e.id===n?Object.assign(e,{...e,...r}):e)},E=(e,t)=>{let[n,r]=e,{id:i,file:o}=t,a=d()(o);return{imageFiles:{...n,[a]:o},objects:{...r,[i]:{...r[i],imageId:a}}}},L=e=>{let[t,n,r,i]=e,a={id:r.id,imageUrl:r.imageUrl,isLoading:!1,shape:r.shapeProps,name:"Layer ".concat(i),imageId:r.imageId},c=Object.assign({},t,{[r.id]:a}),l=(0,o.qH)(n,c,a,!0);return{imagePreview:null,...l,incrementObjectsCount:!0}},_=e=>{let[t,n,r]=e;return Object.values(r).some(e=>(0,o.FY)(e.shape,{...n,...t}))},N=(e,t)=>{let[n,r]=e,i=t.reduce((e,t)=>{var i;let o=null==n?void 0:n[null==t?void 0:null===(i=t.attrs)||void 0===i?void 0:i.id];return o?{...e,[o.id]:{...o,shape:t.getClientRect({relativeTo:r})}}:e},{});return{...n,...i}},G=e=>{let[t,{value:n},r,i,o]=e,a=t.reduce((e,t)=>{if(o.includes(t.id)){let i=null==r?void 0:r.findOne("#".concat(t.id)),o=null==i?void 0:i.toDataURL({pixelRatio:.1/n,quality:1});if(!o)return{...e,list:[...e.list,t],failedPreviewIds:[...e.failedPreviewIds,t.id]};{let n=d()(o);return{...e,list:[...e.list,{...t,preview:n}],images:{...e.images,[n]:o}}}}return{...e,list:[...e.list,t]}},{list:[],images:{},failedPreviewIds:[]});return{list:a.list,images:{...i,...a.images},failedPreviewIds:a.failedPreviewIds,groupPreviewIdsQue:[]}},D=(e,t)=>{var n;let[r,i]=e,a=JSON.parse(JSON.stringify(i)),l=JSON.parse(JSON.stringify(r)),u=l,s=a,d=[],g=l.find(e=>e.id===t.from.groupId),p=null==g?void 0:null===(n=g.objects)||void 0===n?void 0:n.findIndex(e=>e===t.from.objectId);if(void 0===p||p<0)return{list:u,objects:s,groupId:d};if("group"===t.to.type&&"middle"===t.to.position)t.to.groupId!==t.from.groupId&&(u=[...l].reduce((e,n)=>(n.id===t.from.groupId&&n.objects.splice(p,1),n.id===t.to.groupId&&(n.objects=[t.from.objectId,...n.objects]),n.objects.length>0)?[...e,n]:e,[]),s={...a,[t.from.objectId]:{...a[t.from.objectId],groupId:t.to.groupId}}),d=[t.from.groupId,t.to.groupId];else if("group"===t.to.type&&["top","bottom"].includes(t.to.position)){let e=(0,c.k)();u=[...l].reduce((n,r,i)=>(r.id===t.from.groupId&&r.objects.splice(p,1),i===t.to.index)?"top"===t.to.position?[...n,{id:e,name:"Composition",objects:[t.from.objectId]},r.objects.length>0?r:null]:[...n,r.objects.length>0?r:null,{id:e,name:"Composition",objects:[t.from.objectId]}]:r.objects.length>0?[...n,r]:n,[]).filter(e=>e),s={...a,[t.from.objectId]:{...a[t.from.objectId],groupId:e}},d=[e,t.from.groupId]}else u=[...l].reduce((e,n)=>{if(t.to.groupId===t.from.groupId){if(n.id===t.to.groupId){let e="top"===t.to.position?Math.max(t.to.index>p?t.to.index-1:t.to.index,0):Math.min(t.to.index>p?t.to.index:t.to.index+1,n.objects.length);n.objects=(0,o.aC)(n.objects,p,e)}}else if(n.id===t.from.groupId&&n.objects.splice(p,1),n.id===t.to.groupId){let e="top"===t.to.position?t.to.index:t.to.index+1;n.objects=[...n.objects.slice(0,e),t.from.objectId,...n.objects.slice(e)]}return n.objects.length>0?[...e,n]:e},[]),s={...a,[t.from.objectId]:{...a[t.from.objectId],groupId:t.to.groupId}},d=[t.from.groupId,t.to.groupId];return{list:u,objects:s,groupId:d}},x=(e,t)=>{let[n,r]=e,i=JSON.parse(JSON.stringify(r)),a=JSON.parse(JSON.stringify(n)),c=[...a],l={...i},u=[],s=a.findIndex(e=>e.id===t.from.groupId);if(void 0===s||s<0)return{list:c,objects:l,groupId:u};if("group"===t.to.type&&["top","bottom"].includes(t.to.position)){let e="top"===t.to.position?Math.max(t.to.index>s?t.to.index-1:t.to.index,0):Math.min(t.to.index>s?t.to.index:t.to.index+1,a.length);c=(0,o.aC)(a,s,e)}else if("group"===t.to.type&&"middle"===t.to.position){let e=[...a[s].objects];c=[...a].reduce((n,r)=>r.id===t.from.groupId?n:r.id===t.to.groupId?[...n,{...r,objects:[...e,...r.objects]}]:[...n,r],[]),e.forEach(e=>{l[e]={...l[e],groupId:t.to.groupId}}),u=[t.to.groupId]}else if("object"===t.to.type){let e=[...a[s].objects];c=[...a].reduce((n,r)=>{if(r.id===t.from.groupId)return n;if(r.id===t.to.groupId){let i="top"===t.to.position?t.to.index:t.to.index+1;return[...n,{...r,objects:[...r.objects.slice(0,i),...e,...r.objects.slice(i)]}]}return[...n,r]},[]),e.forEach(e=>{l[e]={...l[e],groupId:t.to.groupId}}),u=[t.to.groupId]}return{list:c,objects:l,groupId:u}},C=e=>{let[t,n,r,i]=e,o=JSON.parse(JSON.stringify(t)),a=JSON.parse(JSON.stringify(n)),l=[],u=[],s=[];(0,I.F)("create_copy");let d=r.reduce((e,t)=>{let n=a.find(e=>e.objects.includes(t));return n.objects.length<=1?{...e,groups:[...e.groups,n.id]}:{...e,objects:[...e.objects,t]}},{objects:[],groups:[]}),f=p(a,[...i,...d.groups]),m=g(a,d.objects);if((null==m?void 0:m.length)>0){let e={};m.filter(e=>e).reverse().forEach(t=>{let n=(0,c.k)(),r=o[t],i={...r,id:n,name:r.name+" copy",shape:{...r.shape,x:r.shape.x+16,y:r.shape.y+16}};o[n]=i;let l=a.findIndex(e=>e.id===i.groupId),u=a[l],d=u.objects.findIndex(e=>e===t);u.objects=[...u.objects.slice(0,d),n,...u.objects.slice(d)],e[u.id]=!0,s.push(n)}),l=Object.keys(e)}return(null==f?void 0:f.length)>0&&f.forEach(e=>{let t=(0,c.k)(),n=a.findIndex(t=>t.id===e),r=a[n],i=JSON.parse(JSON.stringify(r));i.objects=[],i.id=t,i.name=1===r.objects.length?i.name:i.name+" copy",r.objects.forEach(e=>{let n=(0,c.k)(),a=o[e];o[n]={...a,name:1===r.objects.length?a.name+" copy":a.name,groupId:t,id:n,shape:{...a.shape,x:a.shape.x+16,y:a.shape.y+16}},i.objects.push(n)}),a=[...a.slice(0,n),i,...a.slice(n)],1===i.objects.length?s.push(i.objects[0]):u.push(i.id)}),{objects:o,list:a,objectsIds:l,selectedGroups:u,selected:s}},Z=e=>{let[t,n,r,i]=e,o=JSON.parse(JSON.stringify(t)),a=JSON.parse(JSON.stringify(n)),c=[];if((null==i?void 0:i.length)>0&&(i.forEach(e=>{let t=a.findIndex(t=>t.id===e),n=a[t];n.objects.forEach(e=>{delete o[e]}),a.splice(t,1)}),(0,I.F)("delete_layer_composition")),(null==r?void 0:r.length)>0){let e={};r.forEach(t=>{let n=o[t].groupId,r=o[t].id;delete o[r];let i=a.findIndex(e=>e.id===n),c=a[i];c.objects=c.objects.filter(e=>e!==r),0===c.objects.length?a.splice(i,1):e[n]=null}),c=Object.values(e),(0,I.F)("delete_layer_composition")}return{objects:o,list:a,objectsIds:c}},F=async()=>{try{let{data:e}=await y.availabilityCheck();if(["DISABLED_BY_QUEUE","DISABLED_MANUALLY"].includes(e.status))throw Error("notAvailableModel");return{modelAvailable:!0}}catch(e){if(!e.code)return{modelAvailable:!1,addNotification:{messageKey:e.message,closable:!1,timeout:0,type:f.Pu.ERROR}};return{modelAvailable:!1}}},B=async e=>{if(1===e.length){let t=await (0,o.Tf)(e[0]);(0,m.Z)({content:t,name:"kandinsky-download-".concat(new Date().getTime())})}else if(e.length>1){let t=new(v());e.forEach((e,n)=>{let r=(0,o.Tf)(e);t.file("kandinsky-download-".concat(n,".png"),r)});let n=await t.generateAsync({type:"blob"});(0,m.Z)({content:n,name:"kandinsky-download-".concat(new Date().getTime())})}},H=async e=>{let[t]=e;if(1===t.length)await B([t[0].id]);else if(t.length>1){let e=t.map(e=>e.id);await B(e)}},Y=async e=>{let[t,n]=e;n.length>0?await B(n):t.length>0&&await B(t)},V=e=>({updateGroupPreview:e,failedPreviewIds:[]});var J=n(21247),W=n(74738),z=n(78940),Q=n(76830),$=n(99942),K=n(28660),q=n(24851),X=n(28458),ee=n(63224),et=n(93240),en=n(51241);let er=(0,r.yM)(),ei=(0,r.yM)(),eo=(0,r.yM)(),ea=(0,r.yM)(),ec=(0,r.yM)(),el=(0,r.yM)(),eu=(0,r.yM)(),es=(0,r.GW)(M),ed=(0,r.yM)(),eg=(0,r.yM)(),ep=(0,r.yM)(),ef=(0,r.GW)(S),em=(0,r.yM)(),eh=(0,r.yM)(),ev=(0,r.yM)(),eI=(0,r.yM)(),ey=(0,r.yM)(),eP=(0,r.yM)(),eb=(0,r.yM)(),eM=(0,r.yM)(),eT=(0,r.yM)(),ek=(0,Q.D)(eT,500),ew=(0,r.yM)(),eU=(0,r.yM)(),eS=(0,r.yM)(),eA=(0,r.yM)(),ej=(0,r.yM)(),eR=(0,r.GW)(F),eO=(0,r.yM)(),eE=(0,r.yM)(),eL=(0,r.yM)(),e_=(0,r.yM)();(0,r.UP)({clock:e_,target:(0,J.h)({updateGroupPreview:eT,failedPreviewIds:i.xV}),filter:e=>e&&e.length>0,source:i.xV,fn:V}),(0,r.UP)({clock:eL,target:i.V9,source:i.V9,fn:e=>e+1}),(0,r.UP)({clock:eU,source:[i.RH,i.hZ],target:(0,J.h)({list:i.RH,objects:i.hZ,groupId:eT}),fn:x}),(0,r.UP)({clock:ew,source:[i.RH,i.hZ],target:(0,J.h)({list:i.RH,objects:i.hZ,groupId:eT}),fn:D}),(0,r.UP)({clock:eT,target:i.M6,source:i.M6,fn:(e,t)=>(Array.isArray(t)?[...e,...t]:[...e,t]).reduce((e,t)=>e.includes(t)?e:[...e,t],[])}),(0,r.UP)({clock:ek,target:(0,J.h)({list:i.RH,images:i.lP,failedPreviewIds:i.xV,groupPreviewIdsQue:i.M6}),source:[i.RH,z.$C,et.V6,i.lP,i.M6],fn:G}),(0,r.UP)({clock:[eb,i.hZ],source:[W.YG,W.RR,i.hZ],fn:_,target:i.O1}),(0,r.UP)({clock:er,target:i.YP}),(0,r.UP)({clock:ei,target:i.KR}),(0,r.UP)({clock:ed,target:i.IE}),(0,r.UP)({clock:ev,source:i.hZ,target:i.hZ,fn:R}),(0,r.UP)({clock:eI,source:i.RH,target:i.RH,fn:O}),(0,r.UP)({clock:ec,target:(0,J.h)({objects:ea,previousGeneratedObjectId:er,previousGeneratedObjectFile:ei,continueGeneration:el}),source:[i.YP,$.n,i.hZ,W.lF,W.RR,W.YG,i.KR],fn:b}),(0,r.UP)({clock:el,source:i.KR,target:es,fn:(e,t)=>({object:t,file:e})}),(0,r.UP)({clock:es.doneData,source:[i.RH,i.hZ,i.YP,i.lP],fn:T,target:(0,J.h)({list:eo,objects:ea,imageFiles:i.lP,groupId:eT,censoredPrompt:q.Hs,incrementObjectsCount:eL,setSidebarBadgeStatus:en.Lh})}),(0,r.UP)({clock:[es.failData,es.fail],source:[i.RH,i.hZ,i.YP],fn:k,target:(0,J.h)({list:eo,objects:ea,addNotification:X.Mw,setSidebarBadgeStatus:en.Lh})}),(0,r.UP)({clock:eo,target:i.RH}),(0,r.UP)({clock:ea,target:i.hZ}),(0,r.UP)({clock:eu,source:[i.YP,i.RH,i.hZ],fn:w,target:(0,J.h)({list:eo,objects:ea})}),(0,r.UP)({clock:eg,fn:U,target:(0,J.h)({preview:i.IE,continuePreviewInsert:ep})}),(0,r.UP)({clock:ep,target:ef}),(0,r.UP)({clock:[ef.doneData],source:i.IE,target:i.IE,fn:A}),(0,r.UP)({clock:[ef.failData,ef.fail],target:(0,J.h)({imagePreview:i.IE,addNotification:X.Mw}),fn:j}),(0,r.UP)({clock:em,target:i.IE,source:i.IE,fn:(e,t)=>Object.assign({},e,t)}),(0,r.UP)({clock:eh,target:(0,J.h)({imageFiles:i.lP,objects:i.hZ}),source:[i.lP,i.hZ],fn:E}),(0,r.UP)({clock:ey,source:[i.hZ,i.RH,i.IE,i.V9],target:(0,J.h)({list:i.RH,objects:i.hZ,imagePreview:i.IE,groupId:eT,incrementObjectsCount:eL}),fn:L}),(0,r.UP)({clock:eP,source:[i.IE,i.hZ],target:(0,J.h)({imagePreview:i.IE,objects:i.hZ}),fn:e=>{let[t,n]=e,r={...n};return delete r[t.id],{imagePreview:null,objects:r}}}),(0,r.UP)({clock:eM,source:[i.hZ,et.V6],target:i.hZ,fn:N}),(0,r.UP)({clock:eS,source:[i.hZ,i.RH,K.J1,K.d1],target:(0,J.h)({list:i.RH,objects:i.hZ,objectsIds:eT,selected:K.J1,selectedGroups:K.d1}),fn:C}),(0,r.UP)({clock:eA,source:[i.hZ,i.RH,K.J1,K.d1],target:(0,J.h)({list:i.RH,objects:i.hZ,objectsIds:eT}),fn:Z}),(0,r.UP)({clock:ej,target:eR}),(0,r.UP)({clock:eR.doneData,target:(0,J.h)({modelAvailable:q.hV,addNotification:X.Mw})}),(0,r.UP)({clock:eO,source:[i.RH],fn:H}),(0,r.UP)({clock:eE,source:[K.J1,K.d1],fn:Y}),(0,r.UP)({clock:[ew,eU,eA,ee.tL],target:(0,J.h)({previousFile:i.KR,previousId:i.YP}),fn:()=>({previousFile:null,previousId:null})})},51241:function(e,t,n){n.d(t,{s2:function(){return M},Wg:function(){return k},k$:function(){return P},g2:function(){return y},VI:function(){return m},r3:function(){return v},sN:function(){return b},Lh:function(){return T},fp:function(){return I},nu:function(){return h},Gc:function(){return f}});var r=n(98116),i=n(24851);let o=(e,t)=>void 0!==t?t:!e,a=(e,t)=>{let[n,r]=e,{page:i,status:o}=t;return("video"!==i||n.includes("t2v"))&&("generate"!==i||n.includes("editor"))?r:{...r,[i]:o}},c=(e,t)=>{let n={...e};return delete n[t],n},l=e=>"erase"===e?"generate":"erase",u=(e,t)=>{let[n,r]=e,{id:i,state:o}=t;return Object.keys(n).forEach(e=>{r.includes(e)||delete n[e]}),{...n,[i]:o}};var s=n(22523),d=n(68914),g=n(20093);(0,r.yM)();let p=(0,r.yM)(),f=(0,r.yM)(),m=(0,r.yM)(),h=(0,r.yM)(),v=(0,r.yM)(),I=(0,r.yM)(),y=(0,r.yM)(),P=(0,r.yM)(),b=(0,r.yM)();(0,r.UP)({clock:P,target:i.Nc}),(0,r.UP)({clock:y,target:i.Hs}),(0,r.UP)({clock:I,target:i.Nc,source:i.Nc,fn:l}),(0,r.UP)({clock:v,target:i.uS}),(0,r.UP)({clock:m,target:i.ql}),(0,r.UP)({clock:h,target:i.g9,source:i.g9,fn:e=>!e}),(0,r.UP)({clock:f,source:i.cc,target:i.cc,fn:o}),i.__.on(p,(e,t)=>t);let M=(0,r.$e)(s.hZ,e=>!!Object.values(e).some(e=>!0===e.isLoading)),T=(0,r.yM)();(0,r.UP)({clock:T,source:[d.W,i.$t],fn:a,target:i.$t});let k=(0,r.yM)();(0,r.UP)({clock:k,source:i.$t,fn:c,target:i.$t}),(0,r.UP)({clock:b,target:i.pc,source:[i.pc,g.b3],fn:u})},63224:function(e,t,n){n.d(t,{b1:function(){return el},FS:function(){return ed},P:function(){return ef},tL:function(){return ec},lm:function(){return eg},Tf:function(){return K},jQ:function(){return W},FQ:function(){return ea},Ff:function(){return eo},ZE:function(){return z},gN:function(){return ee},dj:function(){return $},qi:function(){return eu},UP:function(){return es},RS:function(){return q},KR:function(){return en},W_:function(){return et},Lr:function(){return ei}});var r,i,o,a,c=n(98116),l=n(21247),u=n(60855),s=n(27091);let d=e=>{if(!e)return[];let t=e.length,n;for(;t>0;)n=Math.floor(Math.random()*t),t--,[e[t],e[n]]=[e[n],e[t]];return e};var g=n(82843),p=n(40078),f=n(90219),m=n(95657),h=n(29613);let v=(e,t)=>Object.assign({},e,t),I=(e,t)=>{let[n,r,i]=e,o={...n,width:t.width,height:t.height},a={...r,width:t.width,height:t.height},c={...i};return i.video||(c.resolution=t),{ratio:t,generatedItem:c,animationModelParams:o,videoModelParams:a}},y=(e,t)=>{let n,[r,i]=e,o=d(t),a=[];if((null==t?void 0:t.length)>0){let e=null==r?void 0:r[0],t=o[0];for(;a.length<2;)a.push((0,g.aY)(t,e)),t=(o=(0,g.aC)(o,0,o.length-1))[0];n={prompt:(null==t?void 0:t.prompt)||"",prompt_en:(null==t?void 0:t.prompt_en)||""}}return{prompts:o,promptIntl:n,timeLineItems:a,updateAnimationModelParams:{animation_steps:(0,f.kA)(a,r,i)},updateVideoModelParams:{prompt:(null==n?void 0:n.prompt)||""}}},P=e=>{let t,n=d(e);if((null==e?void 0:e.length)>0){let r=e[0];n=(0,g.aC)(n,0,n.length-1),t={prompt:(null==r?void 0:r.prompt)||"",prompt_en:(null==r?void 0:r.prompt_en)||""}}return{prompts:n,promptIntl:t}},b=(e,t)=>{let{from:n,to:r}=t;return(0,g.aC)(e,n,r)},M=(e,t)=>{let[n,r]=e;return{timeLineItems:t,updateAnimationModelParams:{animation_steps:(0,f.kA)(t,n,r)}}},T=(e,t)=>{let[n,r,i]=e,{itemId:o,key:a,value:c}=t,l=n.map(e=>e.id===o?{...e,[a]:c}:e);return{timeLineItems:l,updateAnimationModelParams:{animation_steps:(0,f.kA)(l,r,i)}}},k=e=>{let[t,n,r]=e;return{updateAnimationModelParams:{animation_steps:(0,f.kA)(t,n,r)}}},w=(e,t)=>{let[n,r,i]=e,o=(0,g.aC)(n,t.from,t.to);return{timeLineItems:o,updateAnimationModelParams:{animation_steps:(0,f.kA)(o,r,i)}}},U=(e,t)=>{let[n,r,i]=e,o=n.filter((e,n)=>n!==t);return{timeLineItems:o,updateAnimationModelParams:{animation_steps:(0,f.kA)(o,r,i)}}},S=e=>{var t;let[n,r,i,o]=e,a=n[0],c=[...r,{id:(0,p.k)(),selectedDirection:null==i?void 0:null===(t=i[0])||void 0===t?void 0:t.direction,prompt:(null==a?void 0:a.prompt)||"",prompt_en:(null==a?void 0:a.prompt_en)||""}];return{timeLineItems:c,movePrompt:{from:0,to:n.length-1},updateAnimationModelParams:{animation_steps:(0,f.kA)(c,i,o)}}},A=e=>({addNotification:{messageKey:e.message,timeout:6e4,context:"/t2v"},isModelAvailable:!1}),j=e=>{let[t,n,r,i]=e;return r===s.zZ.ANIMATION?(0,g.Nc)(n,t):(0,g.a$)(n),{generatedItem:{status:m.B.INITIAL,resolution:i}}},R=(e,t)=>{let[n]=e,r={generatedItem:{resolution:n},addNotification:{context:"/t2v",type:h.Pu.ERROR},setSidebarBadgeStatus:{page:"video",status:"error"}};return(null==t?void 0:t.code)?r.addNotification.messageKey=t.message:(r.addNotification.messageKey="videoPage.errors.genError",r.isModelAvailable=!1),r},O=e=>{let[t]=e;return{resolution:t}};var E=n(62735),L=n(75185),_=n(91785),N=n(33299);(r=o||(o={}))[r.DEFAULT=6]="DEFAULT";class G{static async availabilityCheck(e){var t,n;let r;let i=await (0,N.getSession)();return r=(null==i?void 0:null===(t=i.user)||void 0===t?void 0:null===(n=t.roles)||void 0===n?void 0:n.includes("vip"))?o.DEFAULT:e,L.Z.get(_.sR.availabilityCheck,{params:{model_id:r}}).then(e=>e.data).catch(e=>{throw e})}static async sendToGenerate(e){return new Promise(async(t,n)=>{try{var r,i;let o=new FormData,a=JSON.stringify(e),c=await (0,N.getSession)(),l=new Blob([a],{type:"application/json"});o.append("params",l);let u=await L.Z.post(_.sR.sendToGenerate,o,{headers:{"Content-Type":"multipart/form-data"},params:{model_id:(null==c?void 0:null===(r=c.user)||void 0===r?void 0:null===(i=r.roles)||void 0===i?void 0:i.includes("vip"))?6:3}}).then(e=>e.data).catch(e=>{throw e}),s=null==u?void 0:u.uuid,d=(null==u?void 0:u.status_time)?(null==u?void 0:u.status_time)*1e3:1e4;if(s)return this.pocketId=s,await this.checkPocket({pocketId:s,statusTime:d,resolve:t,reject:n,delayed:!0});n(["DISABLED_BY_QUEUE","DISABLED_MANUALLY"].includes(u.model_status)?"notAvailableModel":"errorPerGenerationMsg")}catch(e){n()}})}static async checkPocket(e){try{if(e.delayed){this.generateTimer=setTimeout(async()=>this.checkPocket({...e,delayed:!1}),e.statusTime);return}let t=await L.Z.get(_.sR.checkVideo(e.pocketId)).then(e=>e.data).catch(e=>{throw e});if(t.status===m.B.INITIAL||t.status===m.B.PROCESSING){this.generateTimer=setTimeout(async()=>await this.checkPocket(e),e.statusTime);return}t.status===m.B.FAIL&&e.reject(),e.resolve(t)}catch(t){e.reject()}}static cancelGeneration(){return clearTimeout(this.generateTimer),L.Z.post(_.sR.cancelGeneration(this.pocketId)).then(e=>e.data).catch(e=>{throw e})}}G.generateTimer=null;var D=n(84898);(i=a||(a={}))[i.DEFAULT=5]="DEFAULT";class x{static getPrompts(){return L.Z.get(_.gc.getPrompts).then(e=>e.data).catch(e=>{throw e})}static getDirections(){return L.Z.get(_.gc.getDirections).then(e=>e.data).catch(e=>{throw e})}static async availabilityCheck(e){var t,n;let r;let i=await (0,N.getSession)();return r=(null==i?void 0:null===(t=i.user)||void 0===t?void 0:null===(n=t.roles)||void 0===n?void 0:n.includes("vip"))?a.DEFAULT:e,L.Z.get(_.gc.availabilityCheck,{params:{model_id:r}})}static async sendToGenerate(e){return new Promise(async(t,n)=>{try{var r,i;let o=new FormData,a=JSON.stringify(e),c=await (0,N.getSession)(),l=new Blob([a],{type:"application/json"});o.append("params",l);let u=await L.Z.post(_.gc.sendToGenerate,o,{headers:{"Content-Type":"multipart/form-data"},params:{model_id:(null==c?void 0:null===(r=c.user)||void 0===r?void 0:null===(i=r.roles)||void 0===i?void 0:i.includes("vip"))?5:2}}).then(e=>e.data).catch(e=>{throw e}),s=null==u?void 0:u.uuid,d=(null==u?void 0:u.status_time)?(null==u?void 0:u.status_time)*1e3:1e4;if(s)return this.pocketId=s,await this.checkPocket({pocketId:s,statusTime:d,resolve:t,reject:n,delayed:!0});n(["DISABLED_BY_QUEUE","DISABLED_MANUALLY"].includes(u.model_status)?"notAvailableModel":"errorPerGenerationMsg")}catch(e){n()}})}static async checkPocket(e){try{if(e.delayed){this.generateTimer=setTimeout(async()=>this.checkPocket({...e,delayed:!1}),e.statusTime);return}let t=await L.Z.get(_.gc.checkAnimation(e.pocketId)).then(e=>e.data).catch(e=>{throw e});if(t.status===m.B.INITIAL||t.status===m.B.PROCESSING){this.generateTimer=setTimeout(async()=>await this.checkPocket(e),e.statusTime);return}t.status===m.B.FAIL&&e.reject(),e.resolve(t)}catch(t){e.reject()}}static cancelGeneration(){return clearTimeout(this.generateTimer),L.Z.post(_.gc.cancelGeneration(this.pocketId)).then(e=>e.data).catch(e=>{throw e})}}x.generateTimer=null;let C=(0,c.GW)(async e=>{try{let t=await (e===s.zZ.ANIMATION?x.availabilityCheck(5):G.availabilityCheck(6));if(["DISABLED_BY_QUEUE","DISABLED_MANUALLY"].includes(t.status))throw Error("notAvailableModel");return!0}catch(e){if(!e.code)throw Error(e)}}),Z=(0,c.GW)(async e=>{let[t,n,r,i]=e,o=await (n===s.zZ.ANIMATION?x.sendToGenerate(r):G.sendToGenerate(i)),a=o.uuid;if(a){let e={generatedItem:{...t,uuid:a,status:o.status}};return o.censored&&n!==s.zZ.ANIMATION||o.censored&&o.censored.filter(e=>e).length>0?(e.censoredPrompt={prompt:String(o.censored),context:"/t2v"},e.generatedItem.censored=o.censored,e.setSidebarBadgeStatus={page:"video",status:"error"}):(e.generatedItem.video="data:video/mp4;base64,".concat(o.video),e.setSidebarBadgeStatus={page:"video",status:"success"}),e}throw Error("videoPage.errors.genError")}),F=(0,c.GW)(async e=>{let t;try{return e===s.zZ.ANIMATION?x.cancelGeneration():G.cancelGeneration()}catch(t){console.error(t),(0,D.F)("cancelgenerationerror",{model:e})}return t});var B=n(24851),H=n(22445),Y=n(10953),V=n(28458),J=n(51241);let W=(0,c.yM)("mergeGeneratedItem"),z=(0,c.yM)("resetGeneratedItem");E.Qc.reset(z),(0,c.UP)({clock:W,source:E.Qc,fn:v,target:E.Qc});let Q=(0,c.yM)("setModelType");(0,c.UP)({clock:Q,target:E.bM});let $=(0,c.yM)("setInitialized");(0,c.UP)({clock:$,target:E.hO});let K=(0,c.yM)("initPrompts"),q=(0,c.yM)("setPrompts"),X=(0,c.yM)("movePrompt");(0,c.UP)({clock:K,source:[E.RP,H.W],fn:y,target:(0,l.h)({prompts:E.Cn,promptIntl:E.PT,timeLineItems:E.mh,updateAnimationModelParams:Y.wk,updateVideoModelParams:Y.pg})}),(0,c.UP)({clock:q,fn:P,target:(0,l.h)({prompts:E.Cn,timeLineItems:E.mh,promptIntl:E.PT})}),(0,c.UP)({clock:X,source:E.Cn,fn:b,target:E.Cn});let ee=(0,c.yM)("setDirections");(0,c.UP)({clock:ee,target:E.RP});let et=(0,c.yM)("setRatioList");(0,c.UP)({clock:et,target:E.RO});let en=(0,c.yM)("setRatio");(0,c.UP)({clock:en,source:[u.GA,u.Uy,E.Qc],fn:I,target:(0,l.h)({ratio:E.zG,generatedItem:E.Qc,animationModelParams:u.GA,videoModelParams:u.Uy})});let er=(0,c.yM)("setTimeLineItems"),ei=(0,c.yM)("updateTimeLineItem"),eo=(0,c.yM)("refreshTimeLineItems"),ea=(0,c.yM)("moveTimeLineItem"),ec=(0,c.yM)("deleteScene"),el=(0,c.yM)("addScene");(0,c.UP)({clock:er,source:[E.RP,H.W],fn:M,target:(0,l.h)({timeLineItems:E.mh,updateAnimationModelParams:Y.wk})}),(0,c.UP)({clock:ei,source:[E.mh,E.RP,H.W],fn:T,target:(0,l.h)({timeLineItems:E.mh,updateAnimationModelParams:Y.wk})}),(0,c.UP)({clock:eo,source:[E.mh,E.RP,H.W],fn:k,target:(0,l.h)({updateAnimationModelParams:Y.wk})}),(0,c.UP)({clock:ea,source:[E.mh,E.RP,H.W],fn:w,target:(0,l.h)({timeLineItems:E.mh,updateAnimationModelParams:Y.wk})}),(0,c.UP)({clock:ec,source:[E.mh,E.RP,H.W],fn:U,target:(0,l.h)({timeLineItems:E.mh,updateAnimationModelParams:Y.wk})}),(0,c.UP)({clock:el,source:[E.Cn,E.mh,E.RP,H.W],fn:S,target:(0,l.h)({timeLineItems:E.mh,movePrompt:X,updateAnimationModelParams:Y.wk})});let eu=(0,c.yM)("setPrompt");(0,c.UP)({clock:eu,fn:e=>({prompt:e,updateVideoModelParams:{prompt:e}}),target:(0,l.h)({prompt:E.qs,updateVideoModelParams:Y.pg})});let es=(0,c.yM)("setPromptIntl");(0,c.UP)({clock:es,target:E.PT});let ed=(0,c.yM)("availabilityCheck");(0,c.UP)({clock:ed,source:u.LC,target:C}),(0,c.UP)({source:C.doneData,target:B.hV}),(0,c.UP)({source:C.failData,fn:A,target:(0,l.h)({addNotification:V.Mw,isModelAvailable:B.hV})});let eg=(0,c.yM)("generate"),ep=(0,c.UP)({clock:eg,source:[u.GA,E.Qc,u.LC,E.zG],fn:j,target:(0,l.h)({generatedItem:E.Qc})});(0,c.UP)({clock:ep,source:[E.Qc,u.LC,u.GA,u.Uy],target:Z}),(0,c.UP)({clock:Z.doneData,target:(0,l.h)({generatedItem:E.Qc,setSidebarBadgeStatus:J.Lh,censoredPrompt:B.Hs})}),(0,c.UP)({clock:Z.failData,source:[E.zG],fn:R,target:(0,l.h)({generatedItem:E.Qc,addNotification:V.Mw,isModelAvailable:B.hV,setSidebarBadgeStatus:J.Lh})});let ef=(0,c.yM)("cancelGenerate");(0,c.UP)({clock:ef,source:u.LC,target:F}),(0,c.UP)({clock:F.doneData,source:[E.zG],fn:O,target:E.Qc})},90219:function(e,t,n){n.d(t,{bA:function(){return i},kA:function(){return a},wH:function(){return o}});var r=n(27091);let i=()=>({width:640,height:640,animation_steps:[{prompt:"",negative_prompt:"",direction:r.Ns.UP,acceleration:0}]}),o=()=>({width:512,height:512,prompt:""}),a=(e,t,n)=>e.map(e=>{let r=t.find(t=>t.direction===e.selectedDirection);return{prompt:"en"===n?e.prompt_en:e.prompt,negative_prompt:"",direction:r.direction,acceleration:r.acceleration}})},45877:function(e,t,n){n.d(t,{FY:function(){return h},KF:function(){return v},LY:function(){return j},Tf:function(){return S},WS:function(){return k},Yz:function(){return P},aC:function(){return w},eF:function(){return T},f8:function(){return I},n$:function(){return A},qH:function(){return b},r4:function(){return M},sI:function(){return m}});var r=n(20185),i=n.n(r),o=n(93240),a=n(78940),c=n(74738),l=n(22523),u=n(40078),s=n(94368);n(71863),n(28660);var d=n(75185),g=n(69801),p=n(84898);let f=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,m=e=>l.hZ.getState()[e],h=(e,t)=>{if(!e||!t)return!1;let{x:n,y:r,width:o,height:a}=e,{x:c,y:l,width:u,height:s}=t;return i().Util.haveIntersection({x:c,y:l,width:u,height:s},{x:n,y:r,width:o,height:a})},v=(e,t,n)=>Object.values(e).filter(e=>{let r=Array.isArray(n)?!n.includes(e.id):e.id!==n;return r&&h(e.shape,t)}),I=(e,t)=>{let n=t.findIndex(t=>t.objects.includes(e)),r=t[n].objects.findIndex(t=>t===e);return(n+1)*(r+1)},y=(e,t)=>{let n=t.findIndex(t=>t.id===e.groupId),r=t[n].objects.findIndex(t=>t===e.id);return(n+1)*10+(r+1)},P=(e,t,n,r)=>{let i=Object.values(e).filter(e=>!e.isLoading);return i.sort((e,n)=>y(e,t)-y(n,t)).filter(e=>{let t=Array.isArray(r)?!r.includes(e.id):e.id!==r;return t&&h(e.shape,n)})},b=function(e,t,n){let r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=JSON.parse(JSON.stringify(t)),o=JSON.parse(JSON.stringify(e)),a=v(i,n.shape,n.id);if(!a||0===a.length||r){let e=(0,u.k)(),t=[{id:e,name:"Composition",objects:[n.id]},...o];return{groupId:e,list:t,objects:{...i,[n.id]:{...i[n.id],isLoading:!1,groupId:e}}}}if(1===a.length){let e=a[0].groupId,t=n.groupId,r=o.reduce((r,i)=>(i.id===e&&(i.objects=[n.id,...i.objects]),i.id===t)?r:[...r,i],[]);return{groupId:e,list:r,objects:{...i,[n.id]:{...i[n.id],isLoading:!1,groupId:e}}}}{let e=o.reduce((e,t,n)=>({...e,[t.id]:n}),{}),t=a.reduce((e,t)=>e.includes(t.groupId)?e:[t.groupId,...e],[]).sort((t,n)=>e[t]-e[n]),r=t.splice(0,1)[0],c=o.findIndex(e=>e.id===r);n.groupId=r;let l=[...o],u={...i,[n.id]:{...i[n.id],isLoading:!1,groupId:r}};return l[c].objects.unshift(n.id),t.forEach(e=>{let t=l.findIndex(t=>t.id===e);c=l.findIndex(e=>e.id===r);let n=l[t].objects;l[c].objects=[...l[c].objects,...n],l.splice(t,1)}),Object.values(i).forEach(e=>{t.includes(e.groupId)&&(u[e.id]={...e,groupId:r})}),{list:l,objects:u,groupId:r}}},M=()=>{var e;let t=a.$C.getState(),n=c.RR.getState(),r=o.V6.getState(),i=null===(e=o.iL.getState())||void 0===e?void 0:e.getClientRect(),l=o.Lr.getState();if(!i||!l||!r)return null;{l.opacity(0);let e=r.toDataURL({...i,width:n.width*t.value,height:n.height*t.value,pixelRatio:1/t.value,quality:1});return l.opacity(1),e}},T=(e,t,n)=>Object.assign({},e,{[t]:{...e[t],...n}}),k=(e,t,n,r)=>{var i,o,a;let c=r&&(null==t?void 0:null===(i=t[n])||void 0===i?void 0:i.groupId)?e:e.map(e=>({...e,objects:e.objects.filter(e=>e!==n)})).filter(e=>0!==e.objects.length);return r&&(null==t?void 0:null===(o=t[n])||void 0===o?void 0:o.groupId)?t[n]={...t[n],isLoading:!1}:delete t[n],{groupId:null==t?void 0:null===(a=t[n])||void 0===a?void 0:a.groupId,list:[...c],objects:{...t}}},w=(e,t,n)=>{let r=[...e],i=e[t];return r.splice(t,1),r.splice(n,0,i),r},U=e=>{var t;let n=o.V6.getState(),r=null===(t=null==n?void 0:n.find("#".concat(e)))||void 0===t?void 0:t[0];if(r){let{width:e,height:t}=r.getClientRect({relativeTo:o.xD.getState()}),i=1/a.$C.getState().value;(e>16200||t>16200)&&(i=16200*i/(e>t?e:t));let c=n.find(".object-loader");null==c||c.forEach(e=>{e.opacity(0)});let l=r.toDataURL({pixelRatio:i});return null==c||c.forEach(e=>{e.opacity(1)}),l}return null},S=e=>{let t=U(e);return t?(0,s.v9)(t):null},A=async e=>{if(f.test(e))return e;{let{data:t}=await (0,d.Z)({url:e,method:"GET",responseType:"blob"});return await (0,g.sT)(t)}},j=(e,t)=>{let n=["Prompt"];e.negativePromptDecoder&&n.push("Negative prompt"),"DEFAULT"!==e.style&&n.push("Style"),(0,p.F)(n.join(" + ")),(0,p.F)("style",{style:e.style}),(0,p.F)("image/".concat(t[0],":").concat(t[1])),e.censor.useGigaBeautificator&&(0,p.F)("useArtGPT")}},82843:function(e,t,n){n.d(t,{E4:function(){return d},Nc:function(){return u},Pd:function(){return a},a$:function(){return s},aC:function(){return c},aY:function(){return l}});var r=n(40078),i=n(84898),o=n(27091);let a=()=>({resolution:{title:"1:1",rHeight:1,rWidth:1,width:640,height:640,originalSize:"640 x 640"}}),c=(e,t,n)=>{let r=[...e],i=e[t];return r.splice(t,1),r.splice(n,0,i),r},l=(e,t)=>({id:(0,r.k)(),selectedDirection:null==t?void 0:t.direction,prompt:(null==e?void 0:e.prompt)||"",prompt_en:(null==e?void 0:e.prompt_en)||""}),u=(e,t)=>{var n,r;if(!(null==t?void 0:t.animation_steps))return!1;(0,i.F)("animation/".concat(null==t?void 0:null===(n=t.animation_steps)||void 0===n?void 0:n.length,"scenes")),(0,i.F)("animation/".concat(null==e?void 0:null===(r=e.resolution)||void 0===r?void 0:r.title)),t.animation_steps.forEach(e=>{(0,i.F)("cameramove",{direction:e.direction})})},s=e=>{(0,i.F)("video/".concat(e.resolution.title))},d=()=>[{type:o.zZ.ANIMATION},{type:o.zZ.VIDEO}]},99942:function(e,t,n){n.d(t,{k:function(){return a},n:function(){return c}});var r=n(98116),i=n(74738),o=n(60855);let a=(0,r.$e)(o.lO,o.R4,(e,t)=>e.find(e=>e.name===t.style)||null),c=(0,r.$e)(o.R4,i.RR,(e,t)=>Object.assign({},e,t))},20093:function(e,t,n){n.d(t,{RH:function(){return u},b3:function(){return s},bh:function(){return d}});var r=n(98116),i=n(22523),o=n(71863),a=n(28660),c=n(45877),l=n(93240);let u=(0,r.$e)(i.hZ,e=>Object.values(e).filter(e=>e.imageId||!e.isLoading).length),s=(0,r.$e)(i.RH,e=>e.map(e=>e.id)),d=(0,r.$e)(l.nJ,l.xD,i.hZ,o.w,a.J1,a.d1,(e,t,n,r,i,o)=>{var a;return(null==r?void 0:null===(a=r.path)||void 0===a?void 0:a.length)&&e?(0,c.KF)(n,null==e?void 0:e.getClientRect({relativeTo:t})).filter(e=>!(null==i?void 0:i.length)&&!(null==o?void 0:o.length)||i.includes(e.id)||o.includes(e.groupId)):[]})},71863:function(e,t,n){n.d(t,{U:function(){return o},w:function(){return i}});var r=n(98116);let i=(0,r.MT)(null),o=(0,r.MT)(5)},74738:function(e,t,n){n.d(t,{RR:function(){return o},YG:function(){return i},lF:function(){return c},pN:function(){return u},vd:function(){return l},z_:function(){return a}});var r=n(98116);let i=(0,r.MT)({x:0,y:0}),o=(0,r.MT)({width:1024,height:1024}),a=(0,r.MT)(!1),c=(0,r.MT)([1,1]),l=(0,r.MT)(!0),u=(0,r.MT)({x:0,y:0,width:0,height:0})},78940:function(e,t,n){n.d(t,{$C:function(){return i},CR:function(){return l},Iq:function(){return c},KN:function(){return a},T9:function(){return o}});var r=n(98116);let i=(0,r.MT)({value:1,downscaleCoefficient:.5}),o=(0,r.MT)({x:0,y:0}),a=(0,r.MT)(!1),c=(0,r.MT)({spotLightsPosition:[],cornerPosition:null}),l=(0,r.MT)({gapSize:256,gridLineSize:1})},60855:function(e,t,n){n.d(t,{GA:function(){return l},LC:function(){return a},R4:function(){return c},Uy:function(){return u},lO:function(){return s}});var r=n(98116),i=n(27091),o=n(90219);let a=(0,r.MT)(i.zZ.TEXT_2_IMAGE),c=(0,r.MT)({type:i.XR.generate,style:"DEFAULT",width:1024,height:1024,x:0,y:0,censor:{useGigaBeautificator:!1},generateParams:{query:""}}),l=(0,r.MT)((0,o.bA)()),u=(0,r.MT)((0,o.wH)()),s=(0,r.MT)([])},22523:function(e,t,n){n.d(t,{IE:function(){return l},KR:function(){return c},M6:function(){return p},O1:function(){return s},RH:function(){return o},V9:function(){return d},YP:function(){return a},hZ:function(){return i},lP:function(){return u},xV:function(){return g}});var r=n(98116);let i=(0,r.MT)({}),o=(0,r.MT)([]),a=(0,r.MT)(null),c=(0,r.MT)(null),l=(0,r.MT)(null),u=(0,r.MT)({}),s=(0,r.MT)(!1),d=(0,r.MT)(1),g=(0,r.MT)([]),p=(0,r.MT)([])},93240:function(e,t,n){n.d(t,{FR:function(){return s},Lr:function(){return o},V6:function(){return c},aD:function(){return u},dB:function(){return l},f9:function(){return g},iL:function(){return a},nJ:function(){return d},py:function(){return f},w5:function(){return p},xD:function(){return i}});var r=n(98116);let i=(0,r.MT)(null),o=(0,r.MT)(null),a=(0,r.MT)(null),c=(0,r.MT)(null),l=(0,r.MT)(null),u=(0,r.MT)(null),s=(0,r.MT)(null),d=(0,r.MT)(null),g=(0,r.MT)(null),p=(0,r.MT)(null),f=(0,r.MT)(null)},28660:function(e,t,n){n.d(t,{Dx:function(){return a},J1:function(){return i},d1:function(){return o}});var r=n(98116);let i=(0,r.MT)([]),o=(0,r.MT)([]),a=(0,r.MT)(null)},24851:function(e,t,n){n.d(t,{Nc:function(){return d},Mn:function(){return p},Hs:function(){return v},__:function(){return l},ql:function(){return f},g9:function(){return s},hV:function(){return m},uS:function(){return c},cc:function(){return u},pc:function(){return g},$t:function(){return h}});var r,i,o=n(98116);(r=i||(i={})).generate="generate",r.erase="erase",r.imagePreview="imagePreview";var a=n(22523);let c=(0,o.MT)(!1),l=(0,o.MT)(null),u=(0,o.MT)(!1),s=(0,o.MT)(!1);(0,o.MT)({sidebarBadgesStatusValue:{}});let d=(0,o.MT)(i.generate),g=(0,o.MT)({}),p=(0,o.$e)(d,a.IE,(e,t)=>({isEraserActive:e===i.erase&&!t,isGenerateActive:e===i.generate&&!t,isImagePreviewActive:!!t})),f=(0,o.MT)(!1),m=(0,o.MT)(!1),h=(0,o.MT)({}),v=(0,o.MT)(null)},62735:function(e,t,n){n.d(t,{Cn:function(){return u},PT:function(){return f},Qc:function(){return a},RO:function(){return d},RP:function(){return s},bM:function(){return c},hO:function(){return l},mh:function(){return p},qs:function(){return m},zG:function(){return g}});var r=n(98116),i=n(29153),o=n(82843);let a=(0,r.MT)((0,o.Pd)(),{name:"generatedItem"}),c=(0,r.MT)((0,o.E4)(),{name:"STORE -> modelType"}),l=(0,r.MT)(!1,{name:"STORE -> initialized"}),u=(0,r.MT)([],{name:"STORE -> prompts"}),s=(0,r.MT)([],{name:"STORE -> directions"}),d=(0,r.MT)(i.Z,{name:"STORE -> ratioList"}),g=(0,r.MT)(i.Z[0],{name:"STORE -> ratio"}),p=(0,r.MT)([],{name:"STORE -> timeLineItems"}),f=(0,r.MT)({},{name:"STORE -> promptIntl"}),m=(0,r.MT)("",{name:"STORE -> prompt"})},94296:function(e,t,n){n.d(t,{A:function(){return c}});var r=n(75185),i=n(91785),o=n(33299),a=n(94368);class c{async availabilityCheck(){var e,t;let n=await (0,o.getSession)();return r.Z.get(i.Rf.availabilityCheck,{params:{model_id:(null==n?void 0:null===(e=n.user)||void 0===e?void 0:null===(t=e.roles)||void 0===t?void 0:t.includes("vip"))?4:1}}).then(e=>e).catch(e=>{throw e})}async runModel(e,t){var n,c;let l=new FormData,u=await (0,o.getSession)(),s=JSON.stringify(e),d=new Blob([s],{type:"application/json"});if(l.append("params",d),t){let e=(0,a.v9)(t);l.append("file",e)}return r.Z.post(i.Rf.sendImageToGenerate,l,{headers:{"Content-Type":"multipart/form-data"},params:{model_id:(null==u?void 0:null===(n=u.user)||void 0===n?void 0:null===(c=n.roles)||void 0===c?void 0:c.includes("vip"))?4:1}}).then(e=>e)}checkModel(e){let{pocketId:t}=e;return r.Z.get(i.Rf.checkImage(t)).then(e=>e)}cancelGeneration(e){return r.Z.post(i.Rf.cancelGeneration(e)).then(e=>e.data).catch(e=>{throw e})}static getStyles(){return r.Z.get(i.Rf.getStyles).then(e=>e).catch(e=>{throw e})}static async uploadPreview(e){let t=new FormData;return t.append("file",e),r.Z.post(i.L1.uploadPreview,t,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>e).catch(e=>{throw e})}constructor(){this.generateTimer=null,this.previousGeneratedPocketId=null,this.sendImageToGenerate=async(e,t)=>new Promise(async(n,r)=>{try{var i,o,a;let c=await this.runModel(e,t),l=null===(i=c.data)||void 0===i?void 0:i.uuid;this.previousGeneratedPocketId=l;let u=(null===(o=c.data)||void 0===o?void 0:o.status_time)?(null===(a=c.data)||void 0===a?void 0:a.status_time)*1e3:1e4;if(l)return await this.checkPocket({pocketId:l,statusTime:u,resolve:n,reject:r},!0);r(["DISABLED_BY_QUEUE","DISABLED_MANUALLY"].includes(c.data.model_status)?"notAvailableModel":"errorPerGenerationMsg")}catch(e){r()}}),this.checkPocket=async(e,t)=>{try{if(t)this.generateTimer=setTimeout(async()=>{this.checkPocket(e)},e.statusTime);else{let t=await this.checkModel(e);if("INITIAL"===t.data.status||"PROCESSING"===t.data.status)return this.generateTimer=setTimeout(async()=>await this.checkPocket(e),e.statusTime);"FAIL"===t.data.status&&e.reject(),e.resolve(t)}}catch(t){e.reject()}}}}},29153:function(e,t){t.Z=[{title:"1:1",rHeight:1,rWidth:1,originalSize:"640 x 640",width:640,height:640},{title:"9:16",rHeight:16,rWidth:9,originalSize:"480 x 854",width:480,height:854},{title:"16:9",rHeight:9,rWidth:16,originalSize:"854 x 480",width:854,height:480}]},84898:function(e,t,n){n.d(t,{F:function(){return r}});let r=(e,t)=>{ym&&ym(91316918,"reachGoal",e,t)}},75185:function(e,t,n){var r=n(87066);let i=r.Z.create();i.defaults.withCredentials=!1,t.Z=i},22335:function(e,t){let n=e=>{let{href:t,content:n,name:r}=e,i=document.createElement("a");"string"==typeof n&&(n=new File([n],r));let o=void 0!==n?URL.createObjectURL(n):null;o?i.href=o:"string"==typeof t&&(i.href=t),"string"==typeof r&&(i.download=r),i.target="_blank",i.rel="noreferrer",i.click(),null!==o&&URL.revokeObjectURL(o)};t.Z=n},69801:function(e,t,n){n.d(t,{pn:function(){return a},sT:function(){return i}});var r=n(40078);let i=async e=>new Promise((t,n)=>{let r=new FileReader;r.readAsDataURL(e),r.onload=()=>t(r.result),r.onerror=e=>n(e)}),o=(e,t,n,r)=>{let i={width:e,height:t};return e>t?e>n&&(i.width=n,i.height=t*(n/e)):t>r&&(i.width=e*(r/t),i.height=r),i},a=async(e,t,n,a,c)=>{let l=await i(e),u=o(t,n,a,c);return{...u,key:(0,r.k)(),base64:l}}},94368:function(e,t,n){n.d(t,{v9:function(){return r}});let r=function(e){var t,n;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"uploadedFile",i=e.split(","),o=null===(t=null==i?void 0:null===(n=i[0])||void 0===n?void 0:n.match(/:(.*?);/))||void 0===t?void 0:t[1],a=atob(i[1]),c=a.length,l=new Uint8Array(c);for(;c--;)l[c]=a.charCodeAt(c);return new File([l],r,{type:o})}}}]);